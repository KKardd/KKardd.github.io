<hr />

<p>Dwitter말고 새로운 프로젝트를 시작하려고하니, MVC 패턴을 중요시 여겨 프로젝트를 진행해야 보다, 깔끔하게 진행될 거 같아 복습할겸 이렇게 게시글을 써본다.</p>

<p>강의에서 들었을때 MVC에 대해 난 되게 잘 이해했다고 생각했는데, 게시글을 쓰며 여러군데를 찾아보니까 조금 아쉽게 이해한 거 같았다.</p>

<p>우선 MVC가 무엇인지부터 살펴보자.</p>

<h2 id="mvc">MVC</h2>

<p>MVC는 Model - View - Controller의 앞글자만 따서 만든 단어이다. 세가지가 상호작용하며 진행되는데, 이로 인해 비지니스 로직을 수정할 때, 온갖 코드를 들쑤시며 전부 수정할 소요 없이 알아서 딱 잘 깔끔하고 센스있게 고칠 수 있게 된다. 아래는 상호작용하는 것에 대한 사진이다.</p>

<p><img src="/assets/img/Study/MVC.png" alt="dwitter5" /></p>

<h3 id="model">Model</h3>

<ul>
  <li>Controller와 Database랑 연동되어서 작동한다.</li>
  <li>DB와의 호흡,, 화합,,, 이 주 목적이다.</li>
  <li>Client / View에 노출되지 않는다.</li>
</ul>

<h3 id="controller">Controller</h3>

<ul>
  <li>사용자의 요청을 받고 응답을 조종한다. 즉, 생각하는건 거의 다 지 몫이다. 비지니스 로직에 해당되는 부분.</li>
  <li>View 요청이 들어와서 Controller에서 생각한다음 Model에 데이터 보내달라하고 그걸 받아 View에 다시 띄우는 모든 역할은 Controller가 한다. 바쁨.</li>
</ul>

<h3 id="view">View</h3>

<ul>
  <li>클라이언트에 나타나는 부분.</li>
  <li>HTML / CSS / JS 예쁘게 꾸미고, 화려하게 움직여 표현하는게 얘.</li>
  <li>확실하진 않지만, 백엔드에서의 View는 Router에 해당한다고 생각한다. 제일 바깥에서 Client랑 소통하려하는게 Router기 때문이다.</li>
</ul>

<p>말로만 하면 이해안될 수 있으니 Dwitter에서의 예시를 가져와봤다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">"</span><span class="s2">/tweets</span><span class="dl">"</span><span class="p">,</span> <span class="nx">tweetsRouter</span><span class="p">);</span>
</code></pre></div></div>

<p>이렇게 Router타고 이동하면</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nc">Router</span><span class="p">();</span>


<span class="c1">// GET /tweets</span>
<span class="c1">// GET /tweets?username=:username</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">isAuth</span><span class="p">,</span> <span class="nx">tweetController</span><span class="p">.</span><span class="nx">getTweets</span><span class="p">);</span>

<span class="c1">// GET /tweets/:id</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">isAuth</span><span class="p">,</span> <span class="nx">tweetController</span><span class="p">.</span><span class="nx">getTweet</span><span class="p">);</span>

<span class="c1">// POST /tweets</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">isAuth</span><span class="p">,</span> <span class="nx">validateTweet</span><span class="p">,</span> <span class="nx">tweetController</span><span class="p">.</span><span class="nx">createTweet</span><span class="p">);</span>

<span class="c1">// PUT /tweets/:id</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">isAuth</span><span class="p">,</span> <span class="nx">validateTweet</span><span class="p">,</span> <span class="nx">tweetController</span><span class="p">.</span><span class="nx">updateTweet</span><span class="p">);</span>

<span class="c1">// DELETE /tweets/:id</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">isAuth</span><span class="p">,</span> <span class="nx">tweetController</span><span class="p">.</span><span class="nx">deleteTweet</span><span class="p">);</span>

<span class="c1">// DELETE /tweets?username=:username</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">isAuth</span><span class="p">,</span> <span class="nx">tweetController</span><span class="p">.</span><span class="nx">deleteTweetByUserId</span><span class="p">);</span>

</code></pre></div></div>

<p>각 api마다 Controller에 어떤 함수를 실행시켜야하는지 가르킨다. 이게 <strong>View</strong>다.</p>

<p>그리고 여기서 updateTweet 함수를 예로들면,</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">updateTweet</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">tweet</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">tweetRepository</span><span class="p">.</span><span class="nf">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nx">tweet</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">sendStatus</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">reqUserId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">userId</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">reqTweetId</span> <span class="o">=</span> <span class="nx">tweet</span><span class="p">.</span><span class="nx">userId</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span>
    <span class="nf">if </span><span class="p">(</span><span class="nx">reqUserId</span> <span class="o">!==</span> <span class="nx">reqTweetId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">sendStatus</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">const</span> <span class="nx">updated</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">tweetRepository</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">(</span><span class="nx">updated</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이런식으로 구성되어있다.</p>

<p>여기서 보면 tweet을 찾지 못했을 때 404에러를 띄워준다던가, UserId와 TweetId가 다르다면 다른 사용자가 삭제를 시도한것이기 때문에 403에러를 띄워주는 등 생각해서 뱉어내는 역할인 <strong>Controller</strong>다.</p>

<p>그 후, Id, text 값을 받아 getById와 update 함수를 사용하였는데, update만 예시를 든다면</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Tweet</span> <span class="o">=</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nf">define</span><span class="p">(</span><span class="dl">"</span><span class="s2">tweet</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">id</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">DateTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span>
        <span class="na">autoIncrement</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">allowNull</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">primaryKey</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">text</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">DateTypes</span><span class="p">.</span><span class="nx">TEXT</span><span class="p">,</span>
        <span class="na">allowNull</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Tweet</span><span class="p">.</span><span class="nf">findByPk</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">INCLUDED_USER</span><span class="p">,</span>
    <span class="p">}).</span><span class="nf">then</span><span class="p">((</span><span class="nx">tweet</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">tweet</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">tweet</span><span class="p">.</span><span class="nf">save</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>이런식으로 구성되어있는데, 나는 참고로 Sequelize ORM을 사용한 코드이다.
보다싶이 데이터와 실질적으로 접근하고, 바꾸는 역할을 하는 여기가 <strong>Model</strong>이다.</p>

<p>확실히 100% 블로그에 한번 더 정리하니까 이젠 안 까먹을 거 같다. 좋다 좋아.</p>
